### 布隆过滤器
布隆过滤器是一个大集合的概念，主要是为了在一个非常大的集合中确定某个数据项是否存在的一个过滤器，它允许有一定的失误率；

- 失误率

  如果一个数据项存在集合中，BloomFilter一定会确定该数据项在集合中，但是一个不存在集合中的数据项，BloomFilter也可能有几率认为它存在集合中。



### 落地结构

工程上是一个大数组结构，数组中的每个位置都是一个bit位。

当然没有bit类型的数组，所以可以进行模拟，例如：

```php
int[] array = new int[100];
```

一个int型是32位，在这个int型数组中，第一个数据项表示0到31这段bit位，第二个数据线表示32至63这段bit位，以此类推该数组可以表示3200个bit位。

每个bit位非0即1，它可以用于表示状态，例如某个bit位被描黑了，则该bit位为1，否则为0。



布隆过滤器一般会提供俩个API：

- add()

  将一个字符串添加到布隆过滤器中。

  要将字符串添加到容器中需要对字符串进行转换，将字符串哈希化，然后模以整个容器的bit位大小，就能得到一个0到容器bit位大小减1之间的数，该结果就是要描黑的比特位。

  描黑：计算出要操作的下标，再计算要描黑的位。

  例如需要对63位描黑，先让63除以32，得出要描黑的下标，由于数组的下标是从0开始的，所以结果需要向下取整；然后让63模以32，得出要描黑的位，通过位移运算可以得到我们想要的结果。

- container()

  判断一个字符串是否在布隆过滤器中。

当然布隆过滤器不单单只经过一次哈细化，它会准备多个哈希函数，将一个字符串经过多个哈希函数运算后，使用这多个运算结果进行描黑，或者判断是否在布隆过滤器中。

这是为了降低哈希函数碰撞性，尽量降低判断错误的失误率。



### 失误率

为什么会有失误率？布隆过滤器的大小和失误率有关，如果容器太小，哈希值模以m得到的bit位重复率就很高，失误率便产生了。



#### 容器大小计算

容器的整个大小与输入样本的数量有关，预期失误率有关。

例如给定100亿个数据项，你的预期失误率是0.01%，容器的大小要多大呢，需要的哈希函数要多少呢？



公式：

$m = n * lnP / (ln2)^2$，n是样本量，P是预期失误率，m是布隆过滤器的大小

$k = ln2 * m / n$，m是容器大小，n是样本量

具体公式证明查资料。。。

