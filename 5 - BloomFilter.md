### 布隆过滤器
布隆过滤器是一个大集合的概念，主要是为了在一个非常大的集合中确定某个数据项是否存在的一个过滤器，它允许有一定的失误率；

- 失误率

  如果一个数据项存在集合中，BloomFilter一定会确定该数据项在集合中，但是一个不存在集合中的数据项，BloomFilter也可能有几率认为它存在集合中。



### 落地结构

工程上是一个大数组结构，数组中的每个位置都是一个bit位。

当然没有bit类型的数组，所以可以进行模拟，例如：

```php
int[] array = new int[100];
```

一个int型是32位，在这个int型数组中，第一个数据项表示0到31这段bit位，第二个数据线表示32至63这段bit位，以此类推该数组可以表示3200个bit位，每个bit位非0即1。



布隆过滤器一般会提供俩个API：

- add()

  添加一个字符串，同时在布隆过滤器里面进行描黑。

- container()

  判断一个字符串是否在布隆过滤器中。



将某个bit设置为1(描黑)

假设需要对63位描黑，先让63除以32，得出要描黑的下标，由于数组的下标是从0开始的，所以结果需要向下取整；然后让63模以32，得出要描黑的位，通过位移运算可以得到我们想要的结果。



- 描黑操作

  先计算在哪个整数上描黑，再计算在该整数上哪个bit位上描黑，例如要在2985个bit位上描黑，先确定整数位：floor(2985/32)，再确定bit位：2985%32。

所以布隆过滤器就是比特类型的数组，一个位的数不是0就是1，假设这个数组最低位是0，最高位是m-1，长度是m，长度是m的bit位数组，实际占用大小是m/8个字节。

- 加url操作

  准备k个独立的哈希函数，分别将url哈希化，所得到的哈希值再分别模以m，结果将会得到k个0至m-1的值，这k个0至m-1的值就是要描黑的bit位。

- 查询url操作

  将之前的k个哈希函数对url进行哈希化，所得到k个哈希值分别模以m，将会得到k个0至m-1的值，取出这k个0至m-1bit位上的状态，如果都是1代表着该url在布隆过滤器中。



### 失误率

为什么会有失误率？布隆过滤器的大小和失误率有关，如果容器太小，哈希值模以m得到的bit位重复率就很高，失误率便产生了。



#### 容器大小计算

布隆过滤器的大小与输入样本的数量、失误率的大小有关，可以认为给定样本量大小，失误率大小，求容器大小与独立哈希函数数量?

具体查证相关数学公式和证明。。。



#### 数的划分

- 问题：假定s作为基础划分数量，问一个数能进行多少次划分？

  解答：如果不满一份的数量，结果将小于1；如果满足一份的数量，结果等于1；如果超过一份的数量，结果大于1；所以x/s的结果向上取整，即是划分的次数。

  注：在计算机中由于索引是从0开始的，所以需要向下取整。